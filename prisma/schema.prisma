// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Topic {
  id          String     @id @default(cuid())
  topicId     String     @unique // e.g., "chapter-01", "general-test"
  name        String
  description String
  isGeneral   Boolean    @default(false)
  questions   Question[]
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

model Question {
  id             String    @id @default(cuid())
  topicId        String
  questionNumber Int?      // Some use question_number, some use id
  questionId     Int?      // For chapter questions that use "id"
  question       String
  options        String    // JSON string array
  correctAnswer  String
  hint           String?
  explanation    String?
  questionType   String?   // e.g., "Long Answer"
  marks          Int?
  source         String?
  relatedSection String?
  chapter        String?   // Chapter tag like "chapter-01"
  difficulty     String?   // "easy" or "difficult"
  topic          Topic     @relation(fields: [topicId], references: [topicId])
  attempts       Attempt[]
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@unique([topicId, questionNumber])
  @@index([topicId])
  @@index([chapter])
  @@index([difficulty])
  @@index([chapter, difficulty])
}

model Session {
  id             String    @id @default(cuid())
  sessionId      String    @unique
  topicId        String
  examMode       String?   // 'chapterwise' | 'quick-test' | 'full-test'
  startTime      DateTime
  endTime        DateTime?
  totalQuestions Int       @default(0)
  correctAnswers Int       @default(0)
  wrongAnswers   Int       @default(0)
  hintsUsed      Int       @default(0)
  totalTime      Int       @default(0) // milliseconds
  attempts       Attempt[]
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@index([topicId])
  @@index([startTime])
}

model Attempt {
  id               String   @id @default(cuid())
  sessionId        String
  questionId       String
  questionNumber   String   // Store as string to match questionId from JSON
  correct          Boolean
  timeSpent        Int      // milliseconds
  hintUsed         Boolean  @default(false)
  explanationViewed Boolean @default(false)
  timestamp        DateTime
  session          Session  @relation(fields: [sessionId], references: [sessionId])
  question         Question @relation(fields: [questionId], references: [id])
  createdAt        DateTime @default(now())

  @@index([sessionId])
  @@index([questionId])
  @@index([timestamp])
}
